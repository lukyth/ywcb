<h1>{{track.name}}</h1>
by {{track.user().first().display_name}}
<p>{{track.description}}</p>

{% for item in track.parents %}
parent: <a href="/t/{{item.id}}">{{item.name}}</a>
{% endfor %}

{% for item in rel %}
child: <a href="/t/{{item.track_1().first().id}}">{{item.track_1().first().name}}</a>
{% endfor %}

<p id="player"></p>
<a href="#" id="play">play</a>
<a href="#" id="stop">stop</a>

<a href="/t/{{track.id}}/jam">Jam</a>

<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<script>
(function(){

'use strict';

// i'm in a rush so sloppy coding

var tracks = [
	{% for item in track.parents %}
	[{{item.file|json_encode|raw}}, {{item.shift|json_encode|raw}}],
	{% endfor %}
	[{{track.file|json_encode|raw}}, {{track.shift|json_encode|raw}}],
];

var players = [];

tracks.forEach(function(v){
	var player = $("<audio>").attr({
		'controls': false,
		'preload': true,
		'src': v[0]
	}).appendTo('#player').get(0);
	player._shift = v[1];
	players.push(player);
});

$("#play").click(function(){
	players.forEach(function(item){
		item.pause();
		item.currentTime = Math.max(0, -item._shift);
		if(item._shift > 0){
			item.timeout = setTimeout(function(){
				console.log('play');
				item.play();
			}, item._shift * 1000);
		}else{
			item.play();
		}
	});
	return false;
});

$("#stop").click(function(){
	players.forEach(function(item){
		clearTimeout(item.timeout);
		item.pause();
	});
	return false;
});


})();
</script>